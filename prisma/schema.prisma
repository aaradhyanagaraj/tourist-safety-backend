generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TouristType {
  INDIAN
  FOREIGN
}

model Tourist {
  id                Int       @id @default(autoincrement())
  touristId         String    @unique
  type              String    // "INDIAN" | "FOREIGNER"
  aadhaarHash       String?   // For INDIAN tourists
  visaIdHash        String?   // For FOREIGN tourists

  // Mobile stored encrypted
  mobile            String
  mobileNonce       String
  mobileTag         String

  // Encrypted full payload
  encryptedPayload  String
  payloadNonce      String
  payloadTag        String

  // Wrapped Data Encryption Key (DEK)
  wrappedDek        String
  wrappedDekNonce   String
  wrappedDekTag     String

  // Trip details stored explicitly for queries
  name              String
  age               Int
  gender            String
  address           String
  emergencyContact  String
  travelStart       DateTime
  travelEnd         DateTime
  consent           Boolean   @default(false)

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  locations         Location[]
}



model OtpVerification {
  id        Int      @id @default(autoincrement())
  aadhaar   String
  mobile    String
  otpHash   String
  expiresAt DateTime
  verified  Boolean  @default(false)

  @@unique([aadhaar, mobile])
}

model Location {
  id        Int      @id @default(autoincrement())
  tourist   Tourist  @relation(fields: [touristId], references: [id])
  touristId Int
  latitude  Float
  longitude Float
  accuracy  Float?
  speed     Float?
  heading   Float?
  battery   Float?
  timestamp DateTime @default(now())
}
